#convert bcf to vcf
bcftools view -f PASS -Ov -o ../processed_data/filteredset2014.vcf --threads 8 ../raw_data/filtered-set-2014Apr12.bcf

#filter for accessions with pod data and filter out SNPs with minor allele frequencies less than or equal to .05%
bcftools view -s HM001,HM002,HM003,HM004,HM005,HM006,HM007,HM008,HM009,HM010,HM011,HM013,HM014,HM015,HM016,HM026,HM027,HM028,HM031,HM032,HM033,HM034,HM035,HM036,HM037,HM038,HM039,HM040,HM041,HM042,HM043,HM044,HM045,HM046,HM047,HM048,HM049,HM050,HM051,HM052,HM053,HM054,HM055,HM056,HM057,HM058,HM059,HM060,HM061,HM062,HM063,HM064,HM065,HM066,HM067,HM068,HM069,HM070,HM071,HM072,HM073,HM074,HM075,HM076,HM077,HM078,HM079,HM080,HM081,HM082,HM083,HM084,HM085,HM086,HM087,HM088,HM089,HM091,HM092,HM093,HM095,HM096,HM097,HM098,HM099,HM101,HM105,HM106,HM107,HM108,HM109,HM111,HM112,HM114,HM115,HM117,HM118,HM119,HM120,HM121,HM122,HM124,HM125,HM126,HM127,HM128,HM129,HM130,HM131,HM133,HM134,HM135,HM138,HM139,HM141,HM143,HM145,HM146,HM147,HM148,HM149,HM150,HM151,HM152,HM153,HM154,HM155,HM156,HM157,HM159,HM160,HM161,HM162,HM163,HM164,HM165,HM166,HM167,HM168,HM169,HM170,HM172,HM173,HM175,HM176,HM177,HM178,HM179,HM180,HM181,HM182,HM183,HM184,HM185,HM186,HM187,HM188,HM189,HM190,HM191,HM192,HM193,HM194,HM195,HM196,HM197,HM198,HM199,HM200,HM201,HM202,HM203,HM205,HM206,HM207,HM208,HM209,HM251,HM253,HM256,HM259,HM260,HM266,HM267,HM268,HM269,HM270,HM271,HM276,HM277,HM279,HM287,HM288,HM289,HM290,HM293,HM294,HM296,HM297,HM298,HM299,HM301,HM304,HM305,HM307,HM308,HM309,HM310,HM311,HM312,HM314,HM315,HM316 -q .05:minor --threads 8 --force-samples ../processed_data/filteredset2014.vcf  > ../processed_data/pod_filteredset2014.vcf

echo "Now analyzing for investment"

#filter for accessions with root2shoot data and filter out SNPs with minor allele frequencies less than or equal to .05%
bcftools view -s HM001,HM002,HM003,HM004,HM005,HM006,HM009,HM011,HM014,HM015,HM026,HM027,HM028,HM032,HM033,HM034,HM037,HM039,HM040,HM041,HM042,HM044,HM045,HM046,HM047,HM049,HM050,HM052,HM054,HM055,HM059,HM060,HM061,HM062,HM064,HM065,HM066,HM067,HM071,HM073,HM075,HM079,HM080,HM082,HM084,HM086,HM091,HM092,HM095,HM096,HM097,HM098,HM099,HM101,HM105,HM106,HM107,HM108,HM109,HM111,HM115,HM118,HM119,HM120,HM121,HM122,HM127,HM128,HM129,HM130,HM131,HM133,HM134,HM135,HM138,HM139,HM141,HM143,HM145,HM146,HM147,HM151,HM152,HM153,HM154,HM155,HM156,HM157,HM159,HM165,HM167,HM168,HM169,HM170,HM172,HM173,HM175,HM176,HM177,HM179,HM180,HM181,HM182,HM183,HM184,HM185,HM187,HM188,HM189,HM190,HM192,HM194,HM195,HM196,HM198,HM200,HM201,HM202,HM205,HM206,HM207,HM251,HM253,HM256,HM259,HM260,HM266,HM267,HM268,HM269,HM270,HM271,HM276,HM277,HM279,HM287,HM288,HM289,HM290,HM293,HM294,HM296,HM297,HM298,HM299,HM301,HM304,HM305,HM307,HM308,HM309,HM310,HM311,HM312,HM314,HM315 -q .05:minor --threads 8 --force-samples ../processed_data/filteredset2014.vcf  > ../processed_data/root2shoot_filteredset2014.vcf

echo "Samples selection and minor allele frequency filtering complete"

#filter out SNPS with >10% missing data
bcftools filter -e 'F_MISSING > 0.1' -Ov -o ../processed_data/pod_filteredset2014_cleaned.vcf ../processed_data/pod_filteredset2014.vcf

echo "Now analyzing for investment"

bcftools filter -e 'F_MISSING > 0.1' -Ov -o ../processed_data/root2shoot_filteredset2014_cleaned.vcf ../processed_data/root2shoot_filteredset2014.vcf

echo "SNP filtering complete."